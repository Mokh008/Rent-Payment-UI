<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>نظام دفع الإيجارات</title>

<style>
:root{
  --bg:#F1F5F9;
  --text:#020617;
  --border:#CBD5E1;
  --dark:#020617;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  font-family:"Segoe UI",Tahoma,sans-serif;
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:30px 15px;
}

.container{
  width:100%;
  max-width:1100px;
}

/* ===== Header ===== */
.page-title{
  text-align:center;
  font-size:28px;
  font-weight:800;
  margin-bottom:20px;
}

/* ===== Login Card (Small) ===== */
.main-card{
  background:#fff;
  border-radius:18px;
  padding:22px 20px;
  box-shadow:0 12px 25px rgba(0,0,0,.08);
  text-align:center;
  margin-bottom:25px;
  max-width:420px;
  margin-left:auto;
  margin-right:auto;
}

.main-card label{
  display:block;
  text-align:right;
  font-weight:600;
  margin-bottom:6px;
}

.main-card input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  font-size:15px;
}

.main-btn{
  margin-top:15px;
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background:var(--dark);
  color:#fff;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}

#error{
  margin-top:10px;
  color:#DC2626;
  font-size:13px;
}

/* ===== Loader ===== */
.loader{
  width:36px;
  height:36px;
  border:4px solid #E5E7EB;
  border-top:4px solid #020617;
  border-radius:50%;
  margin:20px auto;
  animation:spin 1s linear infinite;
  display:none;
}
@keyframes spin{ to{ transform:rotate(360deg);} }

/* ===== Table ===== */
.table-wrapper{
  background:#020617;
  border-radius:18px;
  padding:20px;
  color:#E5E7EB;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

th,td{
  padding:12px;
  text-align:center;
}

th{
  color:#93C5FD;
  border-bottom:1px solid #1E293B;
}

tr{
  border-bottom:1px solid #1E293B;
}

.owner{
  color:#FDE68A;
  font-weight:600;
}

select{
  padding:6px 8px;
  border-radius:8px;
}

.pay-btn{
  padding:6px 12px;
  border-radius:8px;
  border:none;
  background:#2563EB;
  color:#fff;
  font-size:13px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

  <!-- Title -->
  <div class="page-title">نظام دفع الإيجارات</div>

  <!-- Login -->
  <div class="main-card">
    <label>رقم المهندس (ID)</label>
    <input id="engineerId" type="text" placeholder="مثال: 1001777">
    <button class="main-btn" onclick="loadData()">عرض البيانات</button>
    <div id="error"></div>
    <div id="loading" class="loader"></div>
  </div>

  <!-- Result -->
  <div id="result"></div>

</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbz1J46xbhrp_1AT5y7Tws8oc3iTkhZTYodbo1gDekk0U4_MePlv1zWn05VmuaJIo866UA/exec";

function formatDate(d){
  if(!d) return "-";
  return new Date(d).toLocaleDateString("ar-EG");
}

function loadData(){
  const id=document.getElementById("engineerId").value.trim();
  const error=document.getElementById("error");
  const loading=document.getElementById("loading");
  const result=document.getElementById("result");

  error.innerText="";
  result.innerHTML="";

  if(!id){
    error.innerText="من فضلك أدخل رقم المهندس";
    return;
  }

  loading.style.display="block";

  fetch(API_URL+"?action=getAssets&engineerId="+id)
    .then(res=>res.json())
    .then(data=>{
      loading.style.display="none";
      showData(data);
    })
    .catch(()=>{
      loading.style.display="none";
      error.innerText="خطأ في الاتصال بالسيرفر";
    });
}

function showData(data){
  const result=document.getElementById("result");

  if(!data || data.length===0){
    result.innerHTML="<p style='text-align:center'>لا توجد بيانات</p>";
    return;
  }

  let html=`
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>المكتب</th>
          <th>الموقع</th>
          <th>النوع</th>
          <th>الإيجار</th>
          <th>بداية العقد</th>
          <th>نهاية العقد</th>
          <th>الأيام المتبقية</th>
          <th>اسم المؤجر</th>
          <th>الشهر</th>
          <th>الدفع</th>
        </tr>
      </thead>
      <tbody>
  `;

  data.forEach(item=>{
    const key=item.assetName.replace(/\s/g,"_");
    html+=`
      <tr>
        <td>${item.assetName}</td>
        <td>${item.location}</td>
        <td>${item.assetType}</td>
        <td>${item.monthlyRent}</td>
        <td>${formatDate(item.contractStart)}</td>
        <td>${formatDate(item.contractEnd)}</td>
        <td>${item.remainingDays}</td>
        <td class="owner">${item.ownerName}</td>
        <td>
          <select id="m_${key}">
            <option value="">اختر الشهر</option>
            <option>12-2025</option>
            <option>01-2026</option>
            <option>02-2026</option>
          </select>
        </td>
        <td>
          <button class="pay-btn">دفع</button>
        </td>
      </tr>
    `;
  });

  html+=`</tbody></table></div>`;
  result.innerHTML=html;
}
</script>

</body>
</html>
